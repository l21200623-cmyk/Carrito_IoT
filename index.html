<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control IoT</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container mt-3">
    <!-- Header de navegaci√≥n entre apps -->
    <nav class="panel d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-2">
        <h4 class="m-0">Aplicaci√≥n de Control</h4>
        <span class="badge bg-primary">Control</span>
      </div>
      <div class="d-flex gap-2">
        <a class="btn primary" href="./index.html">Control</a>
        <a class="btn ghost" href="./monitor/index.html">‚Üî Ir a Monitoreo</a>
      </div>
    </nav>

    <!-- Selector de dispositivo -->
    <section class="panel panel-device">
      <div class="row g-2 align-items-end justify-content-center">
        <div class="col-12 col-md-3">
          <label class="form-label mb-1">Dispositivo (ID en BD)</label>
          <input id="deviceIdInput" type="number" class="form-control" min="1" step="1" placeholder="1">
        </div>
        <div class="col-12 col-md-2 d-grid">
          <button id="btnSetDevice" class="btn primary">Conectar</button>
        </div>
        <div class="col-12 col-md-7 text-start text-md-end">
          <div class="status-box d-inline-block">
            <span class="fw-semibold">Estado:</span>
            <span id="estado" class="fw-semibold fst-italic">EN ESPERA</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Panel de control manual -->
    <div class="panel-container mx-auto py-4">
      <div class="row justify-content-center align-items-center g-3">
        <!-- Columna izquierda -->
        <div class="col-2 d-flex flex-column align-items-center justify-content-center gap-4">
          <button class="btn-circle" data-status="1" title="Adelante"><i class="fa-solid fa-arrow-up fa-2x"></i></button>
          <button class="btn-circle stop" data-status="3" title="Detener"><i class="fa-solid fa-exclamation fa-2x"></i></button>
          <button class="btn-circle" data-status="2" title="Atr√°s"><i class="fa-solid fa-arrow-down fa-2x"></i></button>
        </div>

        <!-- Centro -->
        <div class="col-8 d-flex justify-content-center align-items-center flex-wrap gap-4">
          <button class="btn-circle" data-status="11" title="Giro 360¬∞ izquierda"><i class="fa-solid fa-rotate-left fa-2x"></i></button>

          <div class="control-grid">
            <button class="btn-square" data-status="5" title="Vuelta adelante izquierda"><i class="fa-solid fa-arrow-up fa-2x rotate--45"></i></button>
            <button class="btn-square" data-status="4" title="Vuelta adelante derecha"><i class="fa-solid fa-arrow-up fa-2x rotate-45"></i></button>
            <button class="btn-square" data-status="9" title="Giro 90¬∞ izquierda"><i class="fa-solid fa-arrow-left fa-2x"></i></button>
            <button class="btn-square" data-status="8" title="Giro 90¬∞ derecha"><i class="fa-solid fa-arrow-right fa-2x"></i></button>
            <button class="btn-square" data-status="7" title="Vuelta atr√°s izquierda"><i class="fa-solid fa-arrow-up fa-2x rotate--135"></i></button>
            <button class="btn-square" data-status="6" title="Vuelta atr√°s derecha"><i class="fa-solid fa-arrow-up fa-2x rotate-135"></i></button>
          </div>

          <button class="btn-circle" data-status="10" title="Giro 360¬∞ derecha"><i class="fa-solid fa-rotate-right fa-2x"></i></button>
        </div>
      </div>

      <!-- Obst√°culo / Evasi√≥n -->
      <div class="row mt-4 justify-content-center">
        <div class="col-12 col-lg-10 p-3 obstacle-box">
          <div class="d-flex flex-wrap align-items-center gap-2">
            <strong>Simular obst√°culo:</strong>
            <select id="obstacleType" class="form-select form-select-sm" style="max-width: 260px;">
              <option value="1">1 ‚Äî Adelante</option>
              <option value="2">2 ‚Äî Adelante-Izquierda</option>
              <option value="3">3 ‚Äî Adelante-Derecha</option>
              <option value="4">4 ‚Äî Adelante-Izquierda-Derecha</option>
              <option value="5">5 ‚Äî Retrocede</option>
            </select>
            <button id="btnObstacle" class="btn warn">‚ö† Obst√°culo</button>
            <span id="obsMsg" class="msg"></span>
          </div>
          <small class="text-muted d-block mt-1">Ejecuta: POST /api/obstaculos y luego POST /api/evasion/ejecutar.</small>
        </div>
      </div>
    </div>

    <!-- Secuencias -->
    <section class="panel panel-seq">
      <h3>Modo autom√°tico ‚Äì Secuencias</h3>
      <div class="seq-controls">
        <button id="btnStartRec" class="btn ghost">üé¨ Grabar secuencia</button>
        <button id="btnStopRec" class="btn ghost" disabled>‚è∏Ô∏è Guardar</button>
        <span id="recBadge" class="badge hidden">Grabando‚Ä¶ 0 pasos</span>
      </div>

      <div class="seq-form hidden" id="seqForm">
        <label>Nombre de la secuencia</label>
        <input id="seqName" type="text" placeholder="Ej. Cuadrado a la izquierda">
        <label>Descripci√≥n (opcional)</label>
        <input id="seqDesc" type="text" placeholder="Notas‚Ä¶">
        <button id="btnSaveSeq" class="btn primary">üíæ Guardar en BD</button>
        <span id="seqSaveMsg" class="msg"></span>
      </div>

      <hr class="soft"/>

      <div class="seq-run">
        <button id="btnReloadSeq" class="btn ghost">üîÑ Recargar</button>
        <select id="seqSelect"></select>
        <button id="btnRunSeq" class="btn success">‚ñ∂ Ejecutar</button>
        <button id="btnStopAuto" class="btn warn">‚ñ† Detener</button>
        <span id="seqRunMsg" class="msg"></span>
      </div>

      <div id="seqPreview" class="seq-preview"></div>
    </section>

    <footer class="footer text-center my-4"><p>Desarrollado por Brandon PM ¬© 2025</p></footer>
  </div>

  <script type="module" src="js/config.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monitoreo IoT</title>

  <!-- Bootstrap + Icons (opcional, igual que en Control) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="icon" type="png" href="icon.png">

  <!-- MISMO estilo que la app de control -->
  <link rel="stylesheet" href="css/styless.css">
</head>
<body>
  <div class="container mt-3">

    <!-- Nav entre apps -->
    <nav class="panel d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-2">
        <h4 class="m-0">Monitoreo IoT</h4>
        <span class="badge bg-secondary">Dashboard</span>
      </div>
      <div class="d-flex gap-2">
        <!-- Ajusta la ruta si tu index de Control no estÃ¡ en el raÃ­z -->
        <a class="btn ghost" href="../index.html">â†” Ir a Control</a>
        <a class="btn primary" href="./index.html">Monitoreo</a>
      </div>
    </nav>

    <!-- Selector de dispositivo -->
    <section class="panel panel-device">
      <div class="row g-2 align-items-end">
        <div class="col-12 col-md-3">
          <label class="form-label mb-1">Dispositivo (ID en BD)</label>
          <input id="deviceIdInput" type="number" class="form-control" min="1" step="1" placeholder="1">
        </div>
        <div class="col-12 col-md-2 d-grid">
          <button id="btnSetDevice" class="btn primary">Aplicar</button>
        </div>
        <div class="col-12 col-md-7 text-md-end">
          <div class="status-box d-inline-block">
            <span class="fw-semibold">Estado:</span>
            <span id="estado" class="fw-semibold fst-italic">EN ESPERA</span>
          </div>
        </div>
      </div>
      <small class="text-muted d-block mt-1">
        Auto-actualizaciÃ³n cada 5s (configurable) y actualizaciÃ³n por WebSocket si estÃ¡ activo.
      </small>
    </section>

    <!-- Controles de refresco -->
    <section class="panel d-flex flex-wrap align-items-center gap-2">
      <button id="btnRefresh" class="btn ghost">ðŸ”„ Refrescar ahora</button>
      <label class="ms-2 me-1">Auto-refresco</label>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="autoToggle" checked>
      </div>
      <span class="text-muted ms-2" id="lastUpdate">â€”</span>
      <div class="ms-auto">
        <span class="badge bg-info">WS: <span id="wsStatus">conectandoâ€¦</span></span>
      </div>
    </section>

    <!-- Ãšltimos movimientos -->
    <section class="panel">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="m-0"><i class="fa-solid fa-person-running me-2"></i>Ãšltimos movimientos</h5>
        <small class="text-muted">GET /api/movimientos/ultimos?dispositivo_id=â€¦</small>
      </div>
      <div class="table-responsive mt-2">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Movimiento</th>
              <th>Fecha/Hora</th>
            </tr>
          </thead>
          <tbody id="tblMovs">
            <tr><td colspan="3" class="text-muted">Sin datosâ€¦</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Ãšltimos obstÃ¡culos -->
    <section class="panel">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="m-0"><i class="fa-solid fa-triangle-exclamation me-2"></i>Ãšltimos obstÃ¡culos</h5>
        <small class="text-muted">GET /api/obstaculos/ultimos?dispositivo_id=â€¦</small>
      </div>
      <div class="table-responsive mt-2">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>ObstÃ¡culo</th>
              <th>Fecha/Hora</th>
            </tr>
          </thead>
          <tbody id="tblObs">
            <tr><td colspan="3" class="text-muted">Sin datosâ€¦</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Ãšltimas 20 Demos -->
    <section class="panel">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="m-0"><i class="fa-solid fa-list-check me-2"></i>Ãšltimas 20 Demos</h5>
        <small class="text-muted">GET /api/rutas/ultimas?dispositivo_id=â€¦</small>
      </div>
      <div class="table-responsive mt-2">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Fecha creaciÃ³n</th>
            </tr>
          </thead>
          <tbody id="tblRutas">
            <tr><td colspan="3" class="text-muted">Sin datosâ€¦</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer class="footer text-center my-4">
      <p>Desarrollado por Brandon PM Â© 2025</p>
    </footer>
  </div>

  <script type="module" src="js/config.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
